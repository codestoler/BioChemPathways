<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amino Acid | Scientific Edition</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M20 65 L40 50 L60 50 L80 35 M60 50 L75 70' fill='none' stroke='%232ecc71' stroke-width='8' stroke-linecap='round' stroke-linejoin='round'/><circle cx='40' cy='50' r='6' fill='%232c3e50'/></svg>">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js"></script>
    <script src="https://unpkg.com/@rdkit/rdkit/dist/RDKit_minimal.js"></script>

    <style>
        :root {
            --bio-green: #2ecc71;
            --bio-blue: #3498db;   /* Glucogenic */
            --bio-red: #e74c3c;    /* Ketogenic */
            --bio-purple: #9b59b6; /* Both */
            --bg-light: #f9fbfd;
            --text-main: #2c3e50;
        }

        body { background: var(--bg-light); color: var(--text-main); font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; }
        header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); padding: 15px 5%; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #edf2f7; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.4rem; font-weight: 700; color: var(--bio-green); }

        .filter-panel { background: white; padding: 20px 5%; border-bottom: 1px solid #edf2f7; display: flex; flex-direction: column; gap: 15px; }
        .filter-group { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .filter-label { font-size: 0.8rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; min-width: 120px; }
        .btn { border: 1px solid #e2e8f0; padding: 6px 14px; border-radius: 8px; cursor: pointer; background: #f8fafc; transition: 0.2s; font-size: 0.85rem; color: #475569; }
        .btn:hover { border-color: var(--bio-green); background: white; }
        .btn.active { background: var(--bio-green); color: white; border-color: var(--bio-green); }

        .amino-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; padding: 30px 5%; }
        
        /* 卡片基础样式 */
        .card { 
            background: white; 
            border-radius: 12px; 
            padding: 20px 20px 20px 24px; /* 左侧留出更多空间给边框 */
            border: 1px solid #e2e8f0; 
            transition: 0.3s; 
            cursor: pointer; 
            position: relative; 
            overflow: hidden;
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }

        /* 左侧边框颜色标记 */
        .card.border-gluco { border-left: 6px solid var(--bio-blue); }
        .card.border-keto { border-left: 6px solid var(--bio-red); }
        .card.border-both { border-left: 6px solid var(--bio-purple); }

        .card-tag { font-size: 0.65rem; padding: 2px 8px; border-radius: 4px; font-weight: 700; margin-bottom: 10px; display: inline-block; }
        .bg-hydrophobic { background: #e0f2fe; color: #0369a1; }
        .bg-aromatic { background: #fef3c7; color: #92400e; }
        .bg-polar { background: #dcfce7; color: #166534; }
        .bg-acidic { background: #fee2e2; color: #991b1b; }
        .bg-basic { background: #f3e8ff; color: #6b21a8; }
        
        /* 代谢标签颜色 */
        .tag-gluco { background: #ebf5ff; color: var(--bio-blue); }
        .tag-keto { background: #fff1f0; color: var(--bio-red); }
        .tag-both { background: #f9f0ff; color: var(--bio-purple); }

        .card-name { font-size: 1.25rem; font-weight: 700; margin-top: 5px; }
        .card-abbr { color: var(--bio-green); font-size: 0.85rem; margin-top: 2px; display: block;}

        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); display: none; z-index: 1000; justify-content: center; align-items: center; }
        .modal-body { background: white; width: 90%; max-width: 1050px; border-radius: 24px; display: grid; grid-template-columns: 1fr 1fr; height: 650px; overflow: hidden; position: relative; }
        .close-btn { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.2rem; color: #94a3b8; z-index: 10;}
        #viewer { width: 100%; height: 100%; background: #fafafa; }
        .info-pane { padding: 40px; overflow-y: auto; display: flex; flex-direction: column; position: relative; }
        #rdkit-2d-container { margin-top: auto; align-self: flex-end; width: 200px; height: 180px; background: #fff; border-radius: 12px; border: 1px dashed #e2e8f0; display: flex; align-items: center; justify-content: center; overflow: hidden; }

        @media (max-width: 800px) { .modal-body { grid-template-columns: 1fr; height: 85vh; } #viewer { height: 300px; } #rdkit-2d-container { width: 150px; height: 130px; } }
    </style>
</head>
<body>

<header>
    <div class="logo"><i class="fas fa-flask"></i> 20 Amino Acids</div>
    <div id="stats" style="font-size: 0.8rem; color: #64748b;">Loading...</div>
</header>

<div class="filter-panel">
    <div class="filter-group">
        <span class="filter-label">Physicochemical</span>
        <button class="btn active" onclick="filterBy('prop', 'all', this)">All</button>
        <button class="btn" onclick="filterBy('prop', 'Hydrophobic', this)">Hydrophobic</button>
        <button class="btn" onclick="filterBy('prop', 'Aromatic', this)">Aromatic</button>
        <button class="btn" onclick="filterBy('prop', 'Polar', this)">Polar</button>
        <button class="btn" onclick="filterBy('prop', 'Acidic', this)">Acidic</button>
        <button class="btn" onclick="filterBy('prop', 'Basic', this)">Basic</button>
    </div>
    <div class="filter-group">
        <span class="filter-label">Metabolic</span>
        <button class="btn active" onclick="filterBy('meta', 'all', this)">All</button>
        <button class="btn" onclick="filterBy('meta', 'Glucogenic', this)">Glucogenic <small>(+Both)</small></button>
        <button class="btn" onclick="filterBy('meta', 'Ketogenic', this)">Ketogenic <small>(+Both)</small></button>
        <button class="btn" onclick="filterBy('meta', 'Both', this)">Both Only</button>
    </div>
</div>

<main class="amino-grid" id="aminoGrid"></main>

<div id="modal">
    <div class="modal-body">
        <span class="close-btn" onclick="closeModal()"><i class="fas fa-times"></i></span>
        <div id="viewer"></div>
        <div class="info-pane">
            <h2 id="mName" style="margin:0; font-size: 2.2rem;"></h2>
            <span id="mFull" style="color:var(--bio-green); font-weight:700; margin-bottom: 10px; display: block;"></span>
            <div style="margin-bottom: 20px;">
                <span id="mPropTag" class="card-tag"></span>
                <span id="mMetaTag" class="card-tag"></span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.9rem; margin-bottom: 25px;">
                <div><small style="display:block; color:#94a3b8; font-weight: 800;">pI</small><b id="mPi" style="font-size: 1.1rem;"></b></div>
                <div><small style="display:block; color:#94a3b8; font-weight: 800;">MW (g/mol)</small><b id="mMw" style="font-size: 1.1rem;"></b></div>
            </div>
            <p id="mDesc" style="line-height: 1.6; color: #475569; font-size: 0.95rem;"></p>
            <div id="rdkit-2d-container"><div id="rdkit-drawing" style="width: 100%; height: 100%;"></div></div>
        </div>
    </div>
</div>

<script>
    let RDKitModule = null;
    window.initRDKitModule().then(function (instance) {
        RDKitModule = instance;
        render();
    });

    const aminoAcids = [
        { name: "Glycine", abbr: "Gly", code: "G", prop: "Hydrophobic", meta: "Glucogenic", pi: "5.97", mw: "75.07", cid: "750", smiles: "NCC(=O)O", desc: "Simplest amino acid; achiral. Acts as a neurotransmitter and inhibitory regulator." },
        { name: "Alanine", abbr: "Ala", code: "A", prop: "Hydrophobic", meta: "Glucogenic", pi: "6.00", mw: "89.09", cid: "5950", smiles: "C[C@H](N)C(=O)O", desc: "Key in the glucose-alanine cycle, transporting nitrogen to the liver." },
        { name: "Valine", abbr: "Val", code: "V", prop: "Hydrophobic", meta: "Glucogenic", pi: "5.96", mw: "117.15", cid: "6287", smiles: "CC(C)[C@H](N)C(=O)O", desc: "Branched-chain amino acid (BCAA) essential for muscle metabolism and repair." },
        { name: "Leucine", abbr: "Leu", code: "L", prop: "Hydrophobic", meta: "Ketogenic", pi: "5.98", mw: "131.17", cid: "6106", smiles: "CC(C)C[C@H](N)C(=O)O", desc: "Essential BCAA; strictly ketogenic. Stimulates protein synthesis via mTOR." },
        { name: "Isoleucine", abbr: "Ile", code: "I", prop: "Hydrophobic", meta: "Both", pi: "6.02", mw: "131.17", cid: "6306", smiles: "CC[C@H](C)[C@H](N)C(=O)O", desc: "Essential BCAA with two chiral centers. Both glucogenic and ketogenic." },
        { name: "Methionine", abbr: "Met", code: "M", prop: "Hydrophobic", meta: "Glucogenic", pi: "5.74", mw: "149.21", cid: "6137", smiles: "CSCC[C@H](N)C(=O)O", desc: "Universal initiator of protein translation. Major methyl donor in biochemistry." },
        { name: "Proline", abbr: "Pro", code: "P", prop: "Hydrophobic", meta: "Glucogenic", pi: "6.30", mw: "115.13", cid: "145742", smiles: "C1C[C@H](NC1)C(=O)O", desc: "Cyclic amino acid; contains a secondary amine (imino group) that adds structural rigidity." },
        { name: "Phenylalanine", abbr: "Phe", code: "F", prop: "Aromatic", meta: "Both", pi: "5.48", mw: "165.19", cid: "6140", smiles: "N[C@@H](Cc1ccccc1)C(=O)O", desc: "Precursor for tyrosine and dopamine. Both glucogenic and ketogenic." },
        { name: "Tyrosine", abbr: "Tyr", code: "Y", prop: "Aromatic", meta: "Both", pi: "5.66", mw: "181.19", cid: "6057", smiles: "N[C@@H](Cc1ccc(O)cc1)C(=O)O", desc: "Site for phosphorylation and precursor for thyroid hormones. Both glucogenic and ketogenic." },
        { name: "Tryptophan", abbr: "Trp", code: "W", prop: "Aromatic", meta: "Both", pi: "5.89", mw: "204.23", cid: "6305", smiles: "N[C@@H](Cc1c[nH]c2ccccc12)C(=O)O", desc: "Largest amino acid; precursor for serotonin. Both glucogenic and ketogenic." },
        { name: "Serine", abbr: "Ser", code: "S", prop: "Polar", meta: "Glucogenic", pi: "5.68", mw: "105.09", cid: "5951", smiles: "N[C@@H](CO)C(=O)O", desc: "Hydroxyl group is a primary site for glycosylation and phosphorylation." },
        { name: "Threonine", abbr: "Thr", code: "T", prop: "Polar", meta: "Both", pi: "5.60", mw: "119.12", cid: "6288", smiles: "C[C@@H](O)[C@H](N)C(=O)O", desc: "Essential with two chiral centers. Both glucogenic and ketogenic." },
        { name: "Cysteine", abbr: "Cys", code: "C", prop: "Polar", meta: "Glucogenic", pi: "5.07", mw: "121.16", cid: "5862", smiles: "N[C@@H](CS)C(=O)O", desc: "Thiol group forms covalent disulfide bridges, crucial for 3D protein folding." },
        { name: "Asparagine", abbr: "Asn", code: "N", prop: "Polar", meta: "Glucogenic", pi: "5.41", mw: "132.12", cid: "6267", smiles: "N[C@@H](CC(=O)N)C(=O)O", desc: "Site for N-linked glycosylation. First amino acid to be isolated." },
        { name: "Glutamine", abbr: "Gln", code: "Q", prop: "Polar", meta: "Glucogenic", pi: "5.65", mw: "146.14", cid: "5961", smiles: "N[C@@H](CCC(=O)N)C(=O)O", desc: "Major nitrogen carrier; most abundant free amino acid in blood." },
        { name: "Lysine", abbr: "Lys", code: "K", prop: "Basic", meta: "Ketogenic", pi: "9.74", mw: "146.19", cid: "5962", smiles: "NCCCC[C@H](N)C(=O)O", desc: "Strictly ketogenic essential amino acid. Target for methylation." },
        { name: "Arginine", abbr: "Arg", code: "R", prop: "Basic", meta: "Glucogenic", pi: "10.76", mw: "174.20", cid: "6322", smiles: "N[C@@H](CCCNC(=N)N)C(=O)O", desc: "Contains a guanidino group. Essential for urea cycle." },
        { name: "Histidine", abbr: "His", code: "H", prop: "Basic", meta: "Glucogenic", pi: "7.59", mw: "155.15", cid: "6274", smiles: "N[C@@H](Cc1c[nH]cn1)C(=O)O", desc: "Imidazole side chain. Acts as a key buffer in enzyme active sites." },
        { name: "Aspartic Acid", abbr: "Asp", code: "D", prop: "Acidic", meta: "Glucogenic", pi: "2.77", mw: "133.10", cid: "5960", smiles: "N[C@@H](CC(=O)O)C(=O)O", desc: "Excitatory neurotransmitter. Involved in the malate-aspartate shuttle." },
        { name: "Glutamic Acid", abbr: "Glu", code: "E", prop: "Acidic", meta: "Glucogenic", pi: "3.22", mw: "147.13", cid: "33032", smiles: "N[C@@H](CCC(=O)O)C(=O)O", desc: "Most abundant excitatory neurotransmitter. Central to amino metabolism." }
    ];

    let currentProp = 'all';
    let currentMeta = 'all';
    let viewer = null;

    function render() {
        const grid = document.getElementById('aminoGrid');
        grid.innerHTML = '';
        
        const filtered = aminoAcids.filter(a => {
            const propMatch = (currentProp === 'all' || a.prop === currentProp);
            let metaMatch = false;
            if (currentMeta === 'all') metaMatch = true;
            else if (currentMeta === 'Glucogenic') metaMatch = (a.meta === 'Glucogenic' || a.meta === 'Both');
            else if (currentMeta === 'Ketogenic') metaMatch = (a.meta === 'Ketogenic' || a.meta === 'Both');
            else if (currentMeta === 'Both') metaMatch = (a.meta === 'Both');
            return propMatch && metaMatch;
        });

        filtered.forEach(a => {
            const card = document.createElement('div');
            
            // 根据代谢类型分配左边框 Class
            let borderClass = '';
            if(a.meta === 'Glucogenic') borderClass = 'border-gluco';
            else if(a.meta === 'Ketogenic') borderClass = 'border-keto';
            else if(a.meta === 'Both') borderClass = 'border-both';

            card.className = `card ${borderClass}`;
            card.innerHTML = `
                <span class="card-tag bg-${a.prop.toLowerCase()}">${a.prop}</span>
                <div class="card-name">${a.name}</div>
                <span class="card-abbr">${a.abbr} / ${a.code}</span>
            `;
            card.onclick = () => openModal(a);
            grid.appendChild(card);
        });
        document.getElementById('stats').innerText = `Showing ${filtered.length} / 20 Amino Acids`;
    }

    function filterBy(type, value, el) {
        if (type === 'prop') currentProp = value;
        if (type === 'meta') currentMeta = value;
        el.parentElement.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        render();
    }

    function openModal(a) {
        document.getElementById('modal').style.display = 'flex';
        document.getElementById('mName').innerText = a.name;
        document.getElementById('mFull').innerText = `${a.abbr} / ${a.code}`;
        document.getElementById('mPi').innerText = a.pi;
        document.getElementById('mMw').innerText = a.mw;
        document.getElementById('mDesc').innerText = a.desc;
        
        document.getElementById('mPropTag').innerText = a.prop;
        document.getElementById('mPropTag').className = `card-tag bg-${a.prop.toLowerCase()}`;
        
        const metaTag = document.getElementById('mMetaTag');
        metaTag.innerText = a.meta;
        // 弹窗里的标签也对应颜色
        const metaColorClass = a.meta === 'Glucogenic' ? 'tag-gluco' : (a.meta === 'Ketogenic' ? 'tag-keto' : 'tag-both');
        metaTag.className = `card-tag ${metaColorClass}`;

        if (!viewer) viewer = $3Dmol.createViewer("viewer", { backgroundColor: '#fafafa' });
        viewer.clear();
        $3Dmol.download(`cid:${a.cid}`, viewer, {}, function() {
            viewer.setStyle({}, {stick:{radius:0.2}, sphere:{scale:0.3}});
            viewer.zoomTo();
            viewer.render();
            setTimeout(() => viewer.resize(), 100);
        });

        if (RDKitModule) {
            const mol = RDKitModule.get_mol(a.smiles);
            const svg = mol.get_svg(200, 180);
            document.getElementById('rdkit-drawing').innerHTML = svg;
            mol.delete();
        }
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
</script>
</body>
</html>